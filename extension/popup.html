<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>nofussbm popup</title>
	<script type="text/javascript">
		var form, key;
		function onload() {
			form = document.forms.bookmarks;
			key = localStorage.getItem( "key" );
			if ( ! key ) {
				alert( "Please set your API key in nofussbm options" );
			} 
			chrome.tabs.getSelected( null, function( tab ) {
				chrome.tabs.sendRequest( tab.id, {}, function handler( response ) {
					form.url.value = tab.url;
					form.title.value = response.title;
				} );
			} );
		}
		function postUrl() {
			var data = JSON.stringify( { "url": form.url.value, "title": form.title.value, "tags": form.tags.value } );
			var req = new XMLHttpRequest();
			req.onreadystatechange = function() {
				if( this.readyState == 4 && this.status == 200 ) {
					form.status.value = req.responseText;
				} else if ( this.readyState == 4 && this.status != 200 ) {
					form.status.value = 'An error has occurred';
				}
			}
			req.open( "POST", "http://localhost:5000/", true );
			req.setRequestHeader( "Content-Type", "application/json" );
			req.setRequestHeader( "X-Nofussbm", key );
			req.send( data );
			console.log( data );
		}
	</script>
</head>
<body onload="onload()">
	<form action="#" method="post" name="bookmarks">
		<input type="url" name="url" id="url" size="80" placeholder="URL"  autocapitalize="off">
		<input type="text" name="title" id="title" size="80" placeholder="Title">
		<input type="text" name="tags" id="tags" size="80" placeholder="Tags" autofocus>
		<input type="button" value="Post it!" onclick="postUrl()"> Result: <input type="text" name="status" id="status" size="50" readonly>
	</form>
</body>
</html>
