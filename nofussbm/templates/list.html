{% extends "uibase.html" %}

{% block head %}
<style type="text/css">
body { padding-top: 60px; }
.bookmarks .url { font-size: smaller; }
.bookmarks li { margin-bottom: 10px; }
.tag { background-color: #BFBFBF; padding: 1px 3px 2px; border-radius: 3px; color: white; text-decoration: none; font-size: 9.75px;}
.tag a { color: white; }
</style>
<script type="text/javascript" src="/static/jquery.ba-bbq.min.js"></script>
<script type="text/javascript" src="/static/jquery.cookie.js"></script>
<script type="text/javascript">$( document ).ready( function() {

	var qs = $.deparam.querystring();
	if ( qs[ "skip"] == undefined ) { 
		qs[ "skip" ] = 0;
		$( "#prev" ).prop( 'disabled', true );
		$( "#first" ).prop( 'disabled', true );
	} else {
		qs[ "skip" ] = parseInt( qs[ "skip" ] );
	}
	var bookmarks_per_page = $.cookie( "bookmarks_per_page" );
	if ( bookmarks_per_page == null )
		bookmarks_per_page = 10;
	else
		bookmarks_per_page = parseInt( bookmarks_per_page );
	
	function sbm( skip, field ) {
		if ( field != undefined ) {
			var value = $( "#" + field ).val();
				qs[ field ] = value == "" ? undefined : value;
		}
		if ( skip == 0 ) qs[ "skip" ] = undefined;
		else if ( skip == 1 ) qs[ "skip" ] += bookmarks_per_page;
		else qs[ "skip" ] -= bookmarks_per_page;
		var url = $.param.querystring( "", qs );
		window.location.replace( url );
	}
	
	$( "#tags" ).val( qs[ "tags" ] );
	$( "#tags" ).change( function() { sbm( 0, "tags" ); } );
	$( '#tags' ).keypress( function( e ) { if ( e.which == 13 ) { e.preventDefault(); sbm( 0, "tags" ); } } );
	$( "#clear_tags" ).click( function() { $( "#tags" ).val( "" ); sbm( 0, "tags" ); } );

	$( "#title" ).val( qs[ "title" ] );
	$( "#title" ).change( function() { sbm( 0, "title" ); } );
	$( '#title' ).keypress( function( e ) { if ( e.which == 13 ) { e.preventDefault(); sbm( 0, "title" ); } } );
	$( "#clear_title" ).click( function() { $( "#title" ).val( "" ); sbm( 0, "title" ); } );

	$( "#first" ).click( function() { sbm( 0 ); return false; } );
	$( "#prev" ).click( function() { sbm( -1 ); return false; } );
	$( "#next" ).click( function() { sbm( +1 ); return false; } );

} );</script>
{% endblock %}

{% block sidebar %}
	<h1>Filter</h1>
	
	<form action="" method="GET" id="filters" class="form-stacked">
		<div class="clearfix">
			<label>Tags</label>
			<div class="input-append">
				<input class="span3" type="text" id="tags"/>
				<label class="add-on" id="clear_tags"><p style="color:black">x</p></label>
			</div>
		</div><!-- /clearfix -->
		<div class="clearfix">
			<label>Title</label>
			<div class="input-append">
				<input class="span3" type="text" id="title"/>
				<label class="add-on" id="clear_title"><p style="color:black">x</p></label>
			</div>
		</div><!-- /clearfix -->
		<div class="clearfix">
			<label>Navigation</label>
			<div class="input" style="padding-top: 10px;">
				<button class="btn" id="first">⇤</button> <button class="btn" id="prev">←</button> <button class="btn" id="next">→</button>
			</div>
		</div>
	</form>
	
	{% if top_tags %}
	<h1>Top tags</h1>
	<p>
	{% for tag, count in top_tags[ : 100 ] %}
		<a class="tag" href="?tags={{tag}}">{{ tag }}</a> <small>{{ count|int }}</small>
	{% endfor %}
	</p>
	{% endif %}
{% endblock %}	

{% block content %}
		<div class="page-header">
			<h1>Bookmarks</h1>
		</div>

		<ul class="bookmarks unstyled">
			{% for bm in bookmarks %}
			<li>
			<a href="{{ bm[ 1 ] }}">{{ bm[ 2 ] }}</a> ({{ bm[ 0 ] }})
			
			<div>{% for tag in bm[ 3 ] %}<a class="tag" href="?tags={{tag}}">{{ tag }}</a> {% endfor %}</div>
			</li>
			{% endfor %}
		</ul>
{% endblock %}	
